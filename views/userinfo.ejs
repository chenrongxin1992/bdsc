<!DOCTYPE html>
<html>
  <head>
    <title>用户信息登记</title>
    <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="format-detection" content="telephone=no">
  <link rel="stylesheet" href="./stylesheets/mytemplate/layui.css" media="all" />
  <link rel="stylesheet" href="../stylesheets/mytemplate/public.css" media="all" />
  <link rel="shortcut icon" href="./favicon.ico" />
  <style type="text/css">
    .layui-btn {
      background-color: #C70E5C;
    }
  </style>
  </head>
  <body>
    <div class="layui-container">  
      <div class="layui-row" style="text-align: center;">
      <div class="layui-col-xs12">
        <img src="images/5582543_csse_logo.png" style="margin-top:10px;max-width:300px;margin-bottom: 10px;">
      </div>
    </div>
    <div class="layui-container">  
      
    <div>
    <form class="layui-form" action="" style="margin-top:15px;">
            <div class="layui-form-item">
              <label class="layui-form-label">姓名</label>
              <div class="layui-input-block">
                <input type="text" name="realname" required  lay-verify="required" placeholder="请输入真实姓名，方便奖品领取"  class="layui-input" id="realname">
              </div>
            </div>

            <div class="layui-form-item">
              <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formDemo">确认</button>
              </div>
            </div>
          </form>
          <div class="layui-row">
      <div class="layui-col-xs12">
      <p style="text-align: center;">请输入请输入真实姓名，方便领取奖品。</p>
      </div>
    </div>
    <div class="layui-row">
        <div class="layui-col-md12">
        <hr/>
          <p class="footer" style="text-align: center;color: #ccc;"><span>计算机与软件学院 &copy; 2020</span></p>
          <!-- <hr/> -->
        </div>
    </div>
     <!--  <div class="layui-row">
        <div class="layui-col-xs12"> -->
          
        <!-- </div>
      </div> -->
    </div>
  </body>
    <script src="./javascripts/mytemplate/jquery3.2.min.js"></script>
    <script src="./javascripts/mytemplate/layui.all.js"></script>
    <script>
    'use strict'
    $(document).ready(function() {

      let form = layui.form,$ = layui.$,layer=layui.layer
      //监听提交 13760277012
      console.log('sessionStorage',sessionStorage.length)
      if(sessionStorage.length){
        console.log('已输入过姓名')
        $('#realname').val(sessionStorage.getItem('realname'))
      }
      form.on('submit(formDemo)', function(data){
        console.log('data',data)
        data.field.realname = $('#realname').val()
        sessionStorage.setItem('realname',data.field.realname)
        
        //return false
        $.ajax({
          url:'/userinfo',
          type:'POST',
          data:data.field,
          dataType : "json",
          success:function(result){
            console.log('result',result)
            if(result.code == 0){
              console.log('add success')
              //墨绿深蓝风
            let frameindex = layer.msg('已登记，请等待抽奖', {
              skin: 'layui-layer-molv' //样式类名
              ,closeBtn: 0
              ,icon:1
            }, function(){
              layer.close(frameindex);
              parent.layer.closeAll()

            });         
            }else{
              let frameindex =  layer.msg(result.msg, {
              skin: 'layui-layer-molv' //样式类名
              ,closeBtn: 0
              ,icon:0
            }, function(){
              layer.close(frameindex);
            })//
              return false
            }
          },
          error:function(msg){
            console.log('ajax error msg',msg)
          }
        })
        return false;
      });
    })
    </script>

</html>